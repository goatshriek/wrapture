<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Wrapture::WrappedFunctionSpec - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/navigation.js" defer></script>
<script src="../js/search.js" defer></script>
<script src="../js/search_index.js" defer></script>
<script src="../js/searcher.js" defer></script>
<script src="../js/darkfish.js" defer></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">




<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-c-normalize_spec_hash">::normalize_spec_hash</a>
    
    <li ><a href="#method-i-call_from">#call_from</a>
    
    <li ><a href="#method-i-error_check">#error_check</a>
    
    <li ><a href="#method-i-error_check-3F">#error_check?</a>
    
    <li ><a href="#method-i-includes">#includes</a>
    
    <li ><a href="#method-i-return_val_type">#return_val_type</a>
    
    <li ><a href="#method-i-use_return-3F">#use_return?</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Wrapture::WrappedFunctionSpec">
  <h1 id="class-Wrapture::WrappedFunctionSpec" class="class">
    class Wrapture::WrappedFunctionSpec
  </h1>

  <section class="description">
    
<p>A description of a function to be wrapped by another language.</p>

  </section>

  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(spec)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates a wrapped function spec based on the provided spec.</p>

<p>The hash must have the following keys:</p>
<dl class="rdoc-list note-list"><dt>name
<dd>
<p>the name of the wrapped function</p>
</dd><dt>params
<dd>
<p>a list of parameters to supply when calling</p>
</dd></dl>

<p>Each member of the params list must be a hash, with a mandatory key of &#39;value&#39; holding the value to be supplied as the parameter. If only a &#39;name&#39; key is provided, this will be used as the value. A &#39;type&#39; may be supplied as well, and is necessary if an equivalent struct or pointer is to be supplied as the value so that casting can be performed correctly.</p>

<p>The following key is optional:</p>
<dl class="rdoc-list note-list"><dt>includes
<dd>
<p>a list of includes needed for this function</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/wrapture/wrapped_function_spec.rb, line 63</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>(<span class="ruby-identifier">spec</span>)
  <span class="ruby-ivar">@spec</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">normalize_spec_hash</span>(<span class="ruby-identifier">spec</span>)

  <span class="ruby-identifier">check</span> = <span class="ruby-ivar">@spec</span>[<span class="ruby-string">&#39;error-check&#39;</span>]

  <span class="ruby-ivar">@error_rules</span> = <span class="ruby-identifier">check</span>[<span class="ruby-string">&#39;rules&#39;</span>].<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rule_spec</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">RuleSpec</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">rule_spec</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">action</span> = <span class="ruby-identifier">check</span>[<span class="ruby-string">&#39;error-action&#39;</span>]
  <span class="ruby-ivar">@error_action</span> = <span class="ruby-constant">ActionSpec</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">action</span>) <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@error_rules</span>.<span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-normalize_spec_hash" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">normalize_spec_hash</span><span
            class="method-args">(spec)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Normalizes a hash specification of a wrapped function. Normalization will check for things like invalid keys, duplicate entries in include lists, and will set missing keys to their default values (for example, an empty list if no includes are given).</p>
          
          

          
          <div class="method-source-code" id="normalize_spec_hash-source">
            <pre><span class="ruby-comment"># File lib/wrapture/wrapped_function_spec.rb, line 28</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier ruby-title">normalize_spec_hash</span>(<span class="ruby-identifier">spec</span>)
  <span class="ruby-identifier">normalized</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">dup</span>

  <span class="ruby-identifier">normalized</span>[<span class="ruby-string">&#39;params&#39;</span>] <span class="ruby-operator">||=</span> []
  <span class="ruby-identifier">normalized</span>[<span class="ruby-string">&#39;params&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">param_spec</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">param_spec</span>[<span class="ruby-string">&#39;value&#39;</span>] = <span class="ruby-identifier">param_spec</span>[<span class="ruby-string">&#39;name&#39;</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">param_spec</span>[<span class="ruby-string">&#39;value&#39;</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">normalized</span>[<span class="ruby-string">&#39;includes&#39;</span>] = <span class="ruby-constant">Wrapture</span>.<span class="ruby-identifier">normalize_includes</span>(<span class="ruby-identifier">spec</span>[<span class="ruby-string">&#39;includes&#39;</span>])

  <span class="ruby-identifier">normalized</span>[<span class="ruby-string">&#39;error-check&#39;</span>] <span class="ruby-operator">||=</span> {}
  <span class="ruby-identifier">normalized</span>[<span class="ruby-string">&#39;error-check&#39;</span>][<span class="ruby-string">&#39;rules&#39;</span>] <span class="ruby-operator">||=</span> []

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;return&#39;</span>)
    <span class="ruby-identifier">normalized</span>[<span class="ruby-string">&#39;return&#39;</span>] = {}
    <span class="ruby-identifier">normalized</span>[<span class="ruby-string">&#39;return&#39;</span>][<span class="ruby-string">&#39;type&#39;</span>] = <span class="ruby-string">&#39;void&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">normalized</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-call_from" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">call_from</span><span
            class="method-args">(function_spec)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Generates a function call from a provided <a href="FunctionSpec.html"><code>FunctionSpec</code></a>. Paremeters and types are resolved using this function&#39;s context.</p>
          
          

          
          <div class="method-source-code" id="call_from-source">
            <pre><span class="ruby-comment"># File lib/wrapture/wrapped_function_spec.rb, line 78</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">call_from</span>(<span class="ruby-identifier">function_spec</span>)
  <span class="ruby-identifier">resolved_params</span> = []

  <span class="ruby-ivar">@spec</span>[<span class="ruby-string">&#39;params&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">param</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">resolved_params</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">function_spec</span>.<span class="ruby-identifier">resolve_wrapped_param</span>(<span class="ruby-identifier">param</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-node">&quot;#{@spec[&#39;name&#39;]}( #{resolved_params.join(&#39;, &#39;)} )&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-error_check" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">error_check</span><span
            class="method-args">(return_val: &#39;return_val&#39;) { |&quot;if( #{join(&#39; &amp;&amp; &#39;)} ){&quot;| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Yields each line of the error check and any actions taken for this wrapped function. If this function does not have any error check defined, then this function returns without yielding anything.</p>

<p><code>return_val</code> is used as the replacement for a return value signified by the use of RETURN_VALUE_KEYWORD in the spec. If not specified it defaults to +&#39;return_val&#39;+. This parameter was added in release 0.4.2.</p>
          
          

          
          <div class="method-source-code" id="error_check-source">
            <pre><span class="ruby-comment"># File lib/wrapture/wrapped_function_spec.rb, line 95</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">error_check</span>(<span class="ruby-value">return_val:</span> <span class="ruby-string">&#39;return_val&#39;</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@error_rules</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">checks</span> = <span class="ruby-ivar">@error_rules</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">rule</span><span class="ruby-operator">|</span> <span class="ruby-identifier">rule</span>.<span class="ruby-identifier">check</span>(<span class="ruby-value">return_val:</span> <span class="ruby-identifier">return_val</span>) }
  <span class="ruby-keyword">yield</span> <span class="ruby-node">&quot;if( #{checks.join(&#39; &amp;&amp; &#39;)} ){&quot;</span>
  <span class="ruby-keyword">yield</span> <span class="ruby-node">&quot;  #{@error_action.take};&quot;</span>
  <span class="ruby-keyword">yield</span> <span class="ruby-string">&#39;}&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-error_check-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">error_check?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>True if the wrapped function has an error check associated with it.</p>
          
          

          
          <div class="method-source-code" id="error_check-3F-source">
            <pre><span class="ruby-comment"># File lib/wrapture/wrapped_function_spec.rb, line 105</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">error_check?</span>
  <span class="ruby-operator">!</span><span class="ruby-ivar">@error_rules</span>.<span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-includes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">includes</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>A list of includes required for this function call.</p>
          
          

          
          <div class="method-source-code" id="includes-source">
            <pre><span class="ruby-comment"># File lib/wrapture/wrapped_function_spec.rb, line 110</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">includes</span>
  <span class="ruby-identifier">includes</span> = <span class="ruby-ivar">@spec</span>[<span class="ruby-string">&#39;includes&#39;</span>].<span class="ruby-identifier">dup</span>

  <span class="ruby-identifier">includes</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-ivar">@error_action</span>.<span class="ruby-identifier">includes</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">error_check?</span>

  <span class="ruby-identifier">includes</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-return_val_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">return_val_type</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>A <a href="TypeSpec.html"><code>TypeSpec</code></a> describing the type of the return value.</p>

<p>Changed in release 0.4.2 to return a <a href="TypeSpec.html"><code>TypeSpec</code></a> instead of a String.</p>
          
          

          
          <div class="method-source-code" id="return_val_type-source">
            <pre><span class="ruby-comment"># File lib/wrapture/wrapped_function_spec.rb, line 121</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">return_val_type</span>
  <span class="ruby-constant">TypeSpec</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@spec</span>[<span class="ruby-string">&#39;return&#39;</span>][<span class="ruby-string">&#39;type&#39;</span>])
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-use_return-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">use_return?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>True if calling this wrapped function needs to save/use the return value for error checking. This is equivalent to checking all error rules for the use of RETURN_VALUE_KEYWORD.</p>

<p>This method was added in release 0.4.2.</p>
          
          

          
          <div class="method-source-code" id="use_return-3F-source">
            <pre><span class="ruby-comment"># File lib/wrapture/wrapped_function_spec.rb, line 130</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">use_return?</span>
  <span class="ruby-ivar">@error_rules</span>.<span class="ruby-identifier">any?</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:use_return?</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>

</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.1.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

